<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galería Los Grandes Birthday</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos para el fondo y la barra de desplazamiento */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image: url('https://media3.giphy.com/media/7SKOwf1nD6j6XhfLMG/giphy.gif');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -2;
            opacity: 0.3;
        }
        /* Barra de desplazamiento oscura */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a202c; }
        ::-webkit-scrollbar-thumb { background-color: #4a5568; border-radius: 20px; }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans">
    <div id="welcome-modal" class="fixed inset-0 bg-gray-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 transition-opacity duration-500">
    <div class="bg-gray-900 rounded-xl p-6 md:p-10 shadow-2xl max-w-2xl text-center flex flex-col items-center border border-gray-700">
        
        <img src="https://res.cloudinary.com/dws4nvuln/image/upload/v1756701802/WhatsApp_Image_2025-08-30_at_10.45.33_AM_piapyt.jpg" 
             alt="Flyer del Evento" 
             class="w-full max-w-sm h-auto object-contain rounded-lg mb-6">

        <h2 class="text-3xl md:text-4xl font-extrabold text-white mb-4">¡Bienvenido a la Galería del Evento!</h2>
        <p class="text-gray-300 text-base md:text-lg mb-6 leading-relaxed max-w-prose">
            Revive la energía, las sonrisas y los momentos inolvidables. 
            Todo el contenido aquí es **RAW y sin editar**, de libre acceso para ti. 
            Siéntete en total libertad de descargar, compartir y usar el material como prefieras. ¡Es tuyo!
        </p>
        <div class="flex flex-col sm:flex-row gap-4 w-full justify-center">
            <button id="view-gallery-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-colors text-lg shadow-lg">
                Ver Galería
            </button>
        </div>
    </div>
</div>

<div id="main-content" class="opacity-0 transition-opacity duration-500">
    <nav class="sticky top-0 z-40 bg-gray-900/80 backdrop-blur-md shadow-lg">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <span class="text-lg font-bold text-white">Los Grandes Birthday - 30 - Agosto - 2025</span>
            <a href="https://daxiklez.com" target="_blank" rel="noopener noreferrer" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg text-sm transition-colors">
                Apoya al creador
            </a>
        </div>
    </nav>

    <div class="container mx-auto p-4 md:p-8">
        <div class="bg-black/50 backdrop-blur-sm rounded-xl p-6 shadow-2xl">
            
            <header class="flex flex-col md:flex-row justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-white mb-4 md:mb-0">Galería DXZ Prods</h1>
                <div class="flex items-center space-x-4">
                    <label for="itemsPerPage" class="text-sm">Mostrar:</label>
                    <select id="itemsPerPage" class="bg-gray-800 border border-gray-700 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </header>

            <div class="border-b border-gray-700 mb-6">
                <nav id="tabs" class="flex space-x-8">
                    <button data-tab="djs" class="tab-button text-lg font-semibold py-2 border-b-2 border-blue-500 text-white">DJs</button>
                    <button data-tab="razita" class="tab-button text-lg font-semibold py-2 border-b-2 border-transparent text-gray-400 hover:text-white">Razita</button>
                    <button data-tab="videos" class="tab-button text-lg font-semibold py-2 border-b-2 border-transparent text-gray-400 hover:text-white">Videos</button>
                </nav>
            </div>

            <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                </div>
            
            <div id="pagination-controls" class="flex justify-center items-center mt-8 space-x-2">
                </div>

        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
        <div class="relative w-full h-full flex flex-col md:flex-row items-center justify-center gap-6">
            
            <button id="close-modal" class="absolute top-2 right-2 md:top-4 md:right-4 text-white text-4xl hover:text-gray-300 z-50">&times;</button>
            
            <div class="relative flex-grow flex items-center justify-center h-full max-h-[90vh] w-full md:w-auto">
                <img id="modal-img" src="" alt="Vista ampliada" class="max-h-full max-w-full object-contain">
                
                <button id="prev-image" class="absolute top-1/2 -translate-y-1/2 left-3 bg-black/40 p-2 rounded-full text-white text-3xl hover:bg-black/60">&#10094;</button>
                <button id="next-image" class="absolute top-1/2 -translate-y-1/2 right-3 bg-black/40 p-2 rounded-full text-white text-3xl hover:bg-black/60">&#10095;</button>
            </div>

            <div id="metadata-panel" class="w-full md:w-72 bg-gray-900/80 backdrop-blur-md rounded-lg p-5 text-sm space-y-4 flex-shrink-0">
                <h3 class="text-xl font-bold border-b border-gray-700 pb-2">Detalles</h3>
                <div class="space-y-3">
                    <p><strong>Nombre:</strong> <span id="meta-display-name"></span></p>
                    <p><strong>Formato:</strong> <span id="meta-format"></span></p>
                    <p><strong>Tipo:</strong> <span id="meta-resource-type"></span></p>
                    <p><strong>Tamaño:</strong> <span id="meta-bytes"></span></p>
                    <p><strong>Dimensiones:</strong> <span id="meta-dimensions"></span></p>
                </div>
                <button id="download-button" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-center transition-colors disabled:bg-gray-500">
                    Descargar
                </button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
        // --- LÓGICA DEL WELCOME SCREEN ---
    const welcomeModal = document.getElementById('welcome-modal');
    const viewGalleryBtn = document.getElementById('view-gallery-btn');
    const mainContent = document.getElementById('main-content');
    // --- ELEMENTOS DEL DOM ---
    const galleryGrid = document.getElementById('gallery-grid');
    const paginationControls = document.getElementById('pagination-controls');
    const itemsPerPageSelect = document.getElementById('itemsPerPage');
    const tabsContainer = document.getElementById('tabs');
    const modal = document.getElementById('modal');
    const modalImg = document.getElementById('modal-img');
    const closeModalBtn = document.getElementById('close-modal');
    const prevBtn = document.getElementById('prev-image');
    const nextBtn = document.getElementById('next-image');
    const downloadBtn = document.getElementById('download-button');

    // --- ESTADO DE LA APLICACIÓN ---
    let allImages = [];
    let djsImages = [];
    let razitaImages = [];
    let currentImageSet = [];
    let currentImageIndex = 0;
    
    let state = {
        currentPage: 1,
        itemsPerPage: 25,
        activeTab: 'djs'
    };
    
    // --- INICIALIZACIÓN ---
    async function init() {
        try {
            const response = await fetch('data.json');
            if (!response.ok) throw new Error('No se pudo cargar data.json');
            allImages = await response.json();
            allImages.reverse();
            
            djsImages = allImages.filter(img => img.asset_folder === 'DJs');
            razitaImages = allImages.filter(img => img.asset_folder === 'People');

            setupEventListeners();
            updateView();
        } catch (error) {
            galleryGrid.innerHTML = `<p class="col-span-full text-center text-red-400">${error.message}</p>`;
        }
    }
        function enterGallery() {
        // Oculta el modal con una transición
        welcomeModal.classList.add('opacity-0');
        setTimeout(() => {
            welcomeModal.style.display = 'none';
        }, 500); // Coincide con la duración de la transición

        // Muestra el contenido principal con una transición
        mainContent.classList.remove('opacity-0');
    }

    viewGalleryBtn.addEventListener('click', enterGallery);

    // --- MANEJO DE EVENTOS ---
    function setupEventListeners() {
        itemsPerPageSelect.addEventListener('change', (e) => {
            state.itemsPerPage = parseInt(e.target.value);
            state.currentPage = 1;
            updateView();
        });

        tabsContainer.addEventListener('click', (e) => {
            if (e.target.matches('.tab-button')) {
                state.activeTab = e.target.dataset.tab;
                state.currentPage = 1;
                updateView();
            }
        });

        // Eventos del Modal
        closeModalBtn.addEventListener('click', closeModal);
        nextBtn.addEventListener('click', showNextImage);
        prevBtn.addEventListener('click', showPrevImage);
        downloadBtn.addEventListener('click', handleDownload); // Evento para el nuevo botón de descarga
        
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        document.addEventListener('keydown', (e) => {
            if (modal.classList.contains('hidden')) return;
            if (e.key === 'Escape') closeModal();
            if (e.key === 'ArrowRight') showNextImage();
            if (e.key === 'ArrowLeft') showPrevImage();
        });
    }
// Reemplaza esta función completa en tu <script>
function renderPlaceholder() {
    // 1. Tomamos el ID de tu carpeta de Google Drive desde la URL compartida
    const googleDriveFolderId = "1sxOZh-lZQFX-Z84DfJpwkZ_n7roKqUxd";
    
    // 2. Construimos la URL correcta para el iframe
    const embedUrl = `https://drive.google.com/embeddedfolderview?id=${googleDriveFolderId}#list`;

    // 3. Insertamos el iframe en la galería
    galleryGrid.innerHTML = `
        <div class="col-span-full aspect-[4/3] md:aspect-[16/9] bg-gray-800 rounded-lg overflow-hidden">
            <iframe
                src="${embedUrl}"
                width="100%"
                height="100%"
                style="border:0;"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    `;
    
    // Ocultamos la paginación ya que no es necesaria
    paginationControls.innerHTML = '';
}
    // --- FUNCIONES DE RENDERIZADO ---
function updateView() {
    updateActiveTab(); // Mueve esto al inicio

    if (state.activeTab === 'videos') {
        renderPlaceholder();
        return; // Detiene la ejecución para no renderizar la galería
    }

    currentImageSet = state.activeTab === 'djs' ? djsImages : razitaImages;
    renderGallery();
    renderPagination();
}

    function renderGallery() {
        galleryGrid.innerHTML = '';
        const start = (state.currentPage - 1) * state.itemsPerPage;
        const end = start + state.itemsPerPage;
        const paginatedImages = currentImageSet.slice(start, end);

        if (paginatedImages.length === 0) {
            galleryGrid.innerHTML = `<p class="col-span-full text-center text-gray-400">No hay imágenes en esta categoría.</p>`;
            return;
        }

        paginatedImages.forEach((image, index) => {
            const globalIndex = start + index;
            const thumbnailUrl = image.secure_url.replace('/upload/', '/upload/c_fill,w_400,h_400,q_auto/');
            const imgElement = document.createElement('div');
            imgElement.className = 'aspect-square bg-gray-800 rounded-lg overflow-hidden cursor-pointer transform hover:scale-105 transition-transform duration-300';
            imgElement.innerHTML = `<img src="${thumbnailUrl}" alt="${image.display_name}" class="w-full h-full object-cover">`;
            imgElement.addEventListener('click', () => openModal(globalIndex));
            galleryGrid.appendChild(imgElement);
        });
    }

    function renderPagination() {
        paginationControls.innerHTML = '';
        const totalPages = Math.ceil(currentImageSet.length / state.itemsPerPage);
        if (totalPages <= 1) return;

        for (let i = 1; i <= totalPages; i++) {
            const button = document.createElement('button');
            button.innerText = i;
            button.className = `px-3 py-1 rounded-md text-sm font-semibold ${state.currentPage === i ? 'bg-blue-600 text-white' : 'bg-gray-700 hover:bg-gray-600'}`;
            button.addEventListener('click', () => {
                state.currentPage = i;
                updateView();
            });
            paginationControls.appendChild(button);
        }
    }
    
    function updateActiveTab() {
        document.querySelectorAll('.tab-button').forEach(button => {
            if (button.dataset.tab === state.activeTab) {
                button.classList.add('border-blue-500', 'text-white');
                button.classList.remove('border-transparent', 'text-gray-400');
            } else {
                button.classList.remove('border-blue-500', 'text-white');
                button.classList.add('border-transparent', 'text-gray-400');
            }
        });
    }
    
    // --- LÓGICA DEL MODAL ---
    function openModal(index) {
        currentImageIndex = index;
        updateModalContent();
        modal.classList.remove('hidden');
    }

    function closeModal() {
        modal.classList.add('hidden');
    }

    function showNextImage() {
        currentImageIndex = (currentImageIndex + 1) % currentImageSet.length;
        updateModalContent();
    }

    function showPrevImage() {
        currentImageIndex = (currentImageIndex - 1 + currentImageSet.length) % currentImageSet.length;
        updateModalContent();
    }

    function updateModalContent() {
        const image = currentImageSet[currentImageIndex];
        modalImg.src = image.secure_url;
        
        document.getElementById('meta-display-name').textContent = image.display_name || 'N/A';
        document.getElementById('meta-format').textContent = image.format || 'N/A';
        document.getElementById('meta-resource-type').textContent = image.resource_type || 'N/A';
        document.getElementById('meta-bytes').textContent = image.bytes ? `${(image.bytes / (1024 * 1024)).toFixed(2)} MB` : 'N/A';
        document.getElementById('meta-dimensions').textContent = (image.width && image.height) ? `${image.width} x ${image.height}` : 'N/A';
    }

    // --- NUEVA FUNCIÓN DE DESCARGA ---
    async function handleDownload() {
        const image = currentImageSet[currentImageIndex];
        const imageUrl = image.secure_url;
        const originalButtonText = downloadBtn.textContent;

        try {
            downloadBtn.disabled = true;
            downloadBtn.textContent = 'Descargando...';

            // 1. Obtener la imagen como un 'blob'
            const response = await fetch(imageUrl);
            if (!response.ok) throw new Error('La respuesta de la red no fue correcta.');
            const blob = await response.blob();

            // 2. Crear una URL local para el blob
            const url = window.URL.createObjectURL(blob);
            
            // 3. Crear un enlace temporal, asignarle la URL y el nombre, y hacer clic
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `${image.public_id}.${image.format}`; // Nombre del archivo
            document.body.appendChild(a);
a.click();

            // 4. Limpiar
            window.URL.revokeObjectURL(url);
            a.remove();

        } catch (error) {
            console.error('Error al descargar la imagen:', error);
            alert('No se pudo descargar la imagen.');
        } finally {
            // Restaurar el botón
            downloadBtn.disabled = false;
            downloadBtn.textContent = originalButtonText;
        }
    }

    // --- INICIAR LA APLICACIÓN ---
    init();
});
</script>

</body>

</html>
